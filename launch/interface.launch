<?xml version="1.0"?>
<launch>
    <launch>
    <arg name="namespace" default="drone" /> <!-- Modify namespace if needed -->
    <arg name="map_name" default="demo" />
    <arg name="calibrate" default="false" />

    <!-- IP address of the drone -->
    <!--<arg name="ip" default="192.168.42.1" /> -->

    <!-- Parameters specific to Bebop drone (removed) -->
    <!-- <arg name="drone_type" default="bebop2" /> -->
    <!-- <arg name="config_file" default="$(find bebop_driver)/config/defaults.yaml" /> -->
    <!-- <arg name="camera_info_url" default="package://bebop_driver/data/$(arg drone_type)_camera_calib.yaml" /> -->

    <!-- MAVROS, MAVSDK, DroneKit, PyMAVLink configurations (comments) -->
    <!-- 
    <node pkg="mavros" type="mavros_node" name="mavros" output="screen">
        <param name="fcu_url" value="udp://$(arg ip):14540@14557" />
        <param name="gcs_url" value="" />
        <param name="enable_logging" value="true" />
        <param name="target_system_id" value="1" />
        <param name="target_component_id" value="1" />
        <param name="boot_delay" value="5" />
    </node>
    <node pkg="mavsdk" type="mavsdk_node" name="mavsdk" output="screen">
        <param name="connection_url" value="udp://$(arg ip):14540" />
    </node>
    <node pkg="dronekit" type="dronekit_node" name="dronekit" output="screen">
        <param name="connection_url" value="udp:$(arg ip):14540" />
    </node>
    <node pkg="pymavlink" type="pymavlink_node" name="pymavlink" output="screen">
        <param name="connection_url" value="udp:$(arg ip):14540" />
    </node>
    -->

    <!-- Group for drone nodes -->
    <group ns="$(arg namespace)">
        <!-- 
        <node pkg="bebop_driver" name="bebop_driver" type="bebop_driver_node" output="screen">
            <param name="camera_info_url" value="$(arg camera_info_url)" />
            <param name="publish_odom_tf" value="False" />
            <rosparam command="load" file="$(arg config_file)" />
        </node>
        <include file="$(find bebop_description)/launch/description.launch" />
        -->
    </group>

    <node name="interface" pkg="rqt_gui" type="rqt_gui" respawn="false" output="screen" args="--perspective-file $(find indoor_drone)/rqt_config/demo.perspective">
        <!-- <remap from="/takeoff"     to="$(arg namespace)/takeoff"/>
        <remap from="/land"        to="$(arg namespace)/land"/> -->

        <param name="map_name" value="$(arg map_name)" />
    </node>

    <node name="pointcloud_scaler_all" pkg="odom_slam_sensor_fusion" type="pointcloud_scaler" respawn="false" output="screen" args="all">
        <remap from="/input_pointcloud_topic"        to="/orb_slam3/all_points"/>
        <remap from="/scaled_pointcloud_topic"        to="/orb_slam3/all_points_scaled"/>
        <!-- <remap from="/input_pointcloud_topic"        to="/orb_slam2_mono/map_points"/>
        <remap from="/scaled_pointcloud_topic"        to="/orb_slam2_mono/all_points_scaled"/> -->
        <remap from="/set_scale"        to="/pointcloud_scaler_all/set_scale"/>

    </node>
    <node name="pointcloud_scaler_tracked" pkg="odom_slam_sensor_fusion" type="pointcloud_scaler" respawn="false" output="screen">
        <remap from="/input_pointcloud_topic"        to="/orb_slam3/tracked_points"/>
        <remap from="/scaled_pointcloud_topic"        to="/orb_slam3/tracked_points_scaled"/>
        <!-- <remap from="/input_pointcloud_topic"        to="/orb_slam2_mono/tracked_points"/>
        <remap from="/scaled_pointcloud_topic"        to="/orb_slam2_mono/tracked_points_scaled"/> -->
        
        <remap from="/set_scale"        to="/pointcloud_scaler_tracked/set_scale"/>


    </node>


    <node name="frame_aligner" pkg="odom_slam_sensor_fusion" type="slam_aligner.py" respawn="false" output="screen">
        <param name="map_name" value="$(arg map_name)" />
    </node>

    <include file="$(find indoor_drone)/launch/sm.launch">
        <arg name="calibrate" default="$(arg calibrate)" />

    </include>


    <!-- <node name="Kill_button" pkg="drone_control" type="kill_button.py" required="true" output="screen"/>

    <node name="control" pkg="drone_control" required="true" type="control.py" output="screen">
       <param name="calibrate_pid" type="bool" value="false" />
    </node>   -->

</launch>
